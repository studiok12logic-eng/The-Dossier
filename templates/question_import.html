{% extends 'base.html' %}

{% block content %}
<div class="h-full flex flex-col p-6 max-w-2xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center gap-4 border-b border-white/10 pb-4">
        <a href="{% url 'question_list' %}" class="w-8 h-8 flex items-center justify-center text-text-sub hover:text-white rounded-full bg-white/5 transition">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1 class="text-xl font-bold text-white tracking-widest uppercase">Import Questions</h1>
    </div>

    <!-- Info / Instructions -->
    <div class="bg-surface border border-white/10 rounded-xl p-6 space-y-4">
        <p class="text-sm text-text-sub leading-relaxed">
            CSVファイルを使用して質問を一括登録・更新・削除できます。<br>
            <span class="text-yellow-500 font-bold">Shift-JIS</span> または UTF-8 のCSVファイルに対応しています。
        </p>
        
        <div class="bg-black/20 p-4 rounded text-xs font-mono text-gray-400 space-y-2">
            <p><strong class="text-white">CSVフォーマット:</strong></p>
            <p>入力列(n/u/d) | カテゴリー | 共通(TRUE/FALSE) | 表示順 | ランク | 質問名 | 説明 | 例 | 形式 | 選択肢</p>
        </div>
    </div>

    <!-- Form -->
    <div class="bg-surface border border-white/10 rounded-xl p-6">
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div class="space-y-2">
                <label class="text-sm font-bold text-text-main block">CSVファイルを選択</label>
                {{ form.file }}
                {% if form.file.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.file.errors }}</div>
                {% endif %}
            </div>

            {% if error_msg %}
            <div class="p-3 bg-red-500/10 border border-red-500/20 rounded text-red-400 text-sm">
                <i class="fas fa-exclamation-circle mr-2"></i> {{ error_msg }}
            </div>
            {% endif %}

            {% if error_list %}
            <div class="p-4 bg-red-500/10 border border-red-500/20 rounded text-sm space-y-2 max-h-60 overflow-y-auto">
                <h4 class="font-bold text-red-400 mb-2"><i class="fas fa-times-circle mr-1"></i> エラーが発生しました (処理は行われていません)</h4>
                <ul class="list-disc list-inside text-red-300 space-y-1 text-xs">
                    {% for err in error_list %}
                    <li>{{ err }}</li>
                    {% endfor %}
                </ul>
                
                {% if logs %}
                <div class="mt-4 pt-4 border-t border-red-500/20">
                    <h5 class="font-bold text-gray-400 mb-2 text-xs">処理ログ (参考)</h5>
                    <ul class="list-disc list-inside text-gray-500 text-xs font-mono">
                        {% for log in logs %}
                        <li>{{ log }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if success_msg %}
            <div class="p-4 bg-emerald-500/10 border border-emerald-500/20 rounded text-sm space-y-2">
                <h4 class="font-bold text-emerald-400"><i class="fas fa-check-circle mr-1"></i> {{ success_msg }}</h4>
                 {% if logs %}
                <div class="mt-2 pt-2 border-t border-emerald-500/20 max-h-40 overflow-y-auto">
                    <ul class="list-disc list-inside text-gray-400 text-xs font-mono">
                        {% for log in logs %}
                        <li>{{ log }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            <div class="pt-2">
                <a href="{% url 'question_list' %}" class="text-primary text-sm hover:underline">質問一覧に戻る</a>
            </div>
            {% else %}
            <div class="flex justify-end pt-4">
                <button type="submit" class="bg-primary text-black px-6 py-2 rounded font-bold hover:bg-primary/90 transition shadow-lg">
                    インポート実行
                </button>
            </div>
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}
